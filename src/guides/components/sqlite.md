# Storing Data in SQLite

For storing data generated by your plugin, Caido utilizes SQLite databases.

SQLite is a lightweight database engine made available via a small library. It requires no setup, administration or separate server. Instead, all data is stored in a single file.

The `sqlite` interface can be used to create and interact with a SQLite database file to store your Caido plugin data. Operations will be asynchronous using a connection pool of worker threads.

The valid parameter data types that can be stored are: `null`, `number`, `bigint`, `string`, and `Uint8Array`.

## SDK Database Operations

The SDK offers the following operations that can be used on the database object:

The `result` represents the outcome of the database operation:

- `changes`: Returns the number of rows affected by the operation.
- `lastInsertRowid`: Returns the row ID of the last inserted row.
- `.open()`: Returns the database.
- `.prepare()`: Compiles a SQL statement for future execution.
- `.exec()`: Executes one or more statements without returning any results.
- `.get()`: Executes a prepared statement and returns the first result as an object.
- `.run()`: Executes a prepared statement and returns an object of the resulting changes.

The connection pooling can be configured using `OpenOptions`:

- `maxConnections`: The maximum number of concurrent connections. By default it uses 5.
- `minConnections`: The minimum number of concurrent connections to maintain. By default it is set to 0.
- `idleTimeout`: How long connections can remain idle.
- `maxLifetime`: The maximum lifespan of connections.

### /packages/backend/src/index.ts

``` ts
import type { DefineAPI, SDK } from "caido:plugin";

async function initDatabase(sdk: SDK) {
  try {
    // Return the location of the generated SQLite data.db file.
    const dataPath = sdk.meta.path();
    sdk.console.log(`Database will be stored in: ${dataPath}`);
    
    // Create the database.
    const db = await sdk.meta.db();
    
    await db.exec(`
      CREATE TABLE IF NOT EXISTS test (
        id INTEGER PRIMARY KEY,
        name TEXT NOT NULL
      );
    `);

    // ? is a placeholder for the name value.
    const insertStatement = await db.prepare("INSERT INTO test (name) VALUES (?)");
    const result = await insertStatement.run("foo");
    sdk.console.log(`Inserted row with ID: ${result.lastInsertRowid}`);

    // Select all columns in the table.
    const selectStatement = await db.prepare("SELECT * FROM test");
    // Return all rows in the table.
    const rows = await selectStatement.all();
    sdk.console.log("Current records: " + JSON.stringify(rows));

    return db;
  } catch (error) {
    sdk.console.error(`Database initialization failed: ${error}`);
    throw error;
  }
}

export type API = DefineAPI<{
}>;

export async function init(sdk: SDK<API>) {
  await initDatabase(sdk);
  sdk.console.log("Database initialized.");
}
```

## The Result

In your backend logs, you will see the following entries:

``` txt
Database will be stored in: ~[YOUR PATH]\Caido\data\plugins\[UUID]
Inserted row with ID: 1    
Current records: [{"id":1,"name":"foo"}]    
Database initialized.
```
